"use strict";(self.webpackChunkassistant=self.webpackChunkassistant||[]).push([["src_components_Text2Image_Text2ImageDisplay_vue"],{2995:(e,i,n)=>{n.d(i,{A:()=>c});var s=n(6222),a=n(5527),o=n(9226),r=n(6296),A=n(127),l=n(3814),d=n(1651);const c={name:"Text2ImageDisplay",components:{NcLoadingIcon:s.A,InformationOutlineIcon:o.A,AssistantIcon:A.A,Cog:a.A},props:{imageGenId:{type:String,required:!0},forceEditMode:{type:Boolean,default:!1}},data:()=>({prompt:"",loadingImages:!0,imgLoadedList:[],timeUntilCompletion:null,failed:!1,imageUrls:[],isOwner:!1,errorMsg:t("assistant","Image generation failed"),closed:!1,fileVisStatusArray:[],hoveredIndex:-1,hovered:!1,editModeEnabled:!1,waitingInBg:!1}),computed:{loading(){return this.loadingImages&&!this.failed&&this.imageUrls.length>0},hasVisibleImages(){return this.isOwner?this.fileVisStatusArray.some((t=>t.visible)):this.imageUrls.length>0}},watch:{imageGenId(){this.prompt="",this.loadingImages=!0,this.imgLoadedList=[],this.timeUntilCompletion=null,this.failed=!1,this.imageUrls=[],this.isOwner=!1,this.closed=!1,this.fileVisStatusArray=[],this.hoveredIndex=-1,this.hovered=!1,this.editModeEnabled=!1,this.waitingInBg=!1,this.getImageGenInfo(),this.editModeEnabled=this.forceEditMode}},mounted(){this.getImageGenInfo(),this.editModeEnabled=this.forceEditMode},unmounted(){this.closed=!0},methods:{onImageLoad(t){this.imgLoadedList[t]=!0,this.imgLoadedList.every((t=>t))&&(this.loadingImages=!1)},getImages(t,e){this.loadingImages=!0,this.imageUrls=[],this.imgLoadedList=[],this.fileVisStatusArray=e,e.forEach((e=>{this.imageUrls.push((0,l.generateOcsUrl)("/apps/assistant/api/v1/i/{imageGenId}/{fileId}",{imageGenId:t,fileId:e.id})),this.imgLoadedList.push=!1}))},getImageGenInfo(){let e=!1;const i=(0,l.generateOcsUrl)("/apps/assistant/api/v1/i/info/{imageGenId}",{imageGenId:this.imageGenId});r.default.get(i).then((i=>{if(200===i.status){const n=i.data?.ocs?.data;void 0!==n?.files?(this.waitingInBg=!1,0===n.files.length?(this.errorMsg=t("assistant","This generation has no visible images"),this.failed=!0,this.imgLoadedList=[]):(this.prompt=n.prompt,this.isOwner=n.is_owner,e=!0,this.getImages(n.image_gen_id,n.files),this.onGenerationReady())):void 0!==n?.processing?(this.waitingInBg=!0,this.$emit("processing"),this.updateTimeUntilCompletion(n.processing)):(this.errorMsg=t("assistant","Unexpected server response"),this.failed=!0,this.imgLoadedList=[])}else console.error("Unexpected response status: "+i.status),this.errorMsg=t("assistant","Unexpected server response"),this.failed=!0,this.imgLoadedList=[];e||this.failed||this.closed||setTimeout(this.getImageGenInfo,5e3)})).catch((t=>{this.onError(t)}))},updateTimeUntilCompletion(t){t-(0,d.A)().unix()<300?this.timeUntilCompletion=null:(this.timeUntilCompletion=d.A.unix(t).fromNow(),this.closed||setTimeout((()=>{this.updateTimeUntilCompletion(t)}),3e4))},onError(e){429===e.response?.status?(this.errorMsg=t("assistant","Rate limit reached. Please try again later."),this.failed=!0,this.imgLoadedList=[]):void 0!==e.response?.data?(this.errorMsg=e.response.data.error,this.failed=!0,this.imgLoadedList=[]):(console.error("Could not handle response error: "+e),this.errorMsg=t("assistant","Unknown server query error"),this.failed=!0,this.imgLoadedList=[]),this.$emit("failed")},onGenerationReady(){this.$emit("ready")},onCheckboxChange(){const t=(0,l.generateOcsUrl)("/apps/assistant/api/v1/i/visibility/"+this.imageGenId);r.default.post(t,{fileVisStatusArray:this.fileVisStatusArray}).then((t=>{200===t.status||console.error("Unexpected response status: "+t.status)})).catch((t=>{console.error("Could not update visible images: "+t)}))},toggleCheckbox(t){this.fileVisStatusArray[t].visible=!this.fileVisStatusArray[t].visible,this.onCheckboxChange()},toggleEditMode(){this.editModeEnabled=!this.editModeEnabled}}}},6062:(t,e,i)=>{i.d(e,{A:()=>n});const n={name:"AssistantIcon",props:{title:{type:String,default:""},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}}},4481:(t,e,i)=>{i.d(e,{X:()=>n,Y:()=>s});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"display-container"},[e("div",{staticClass:"title"},[e("div",{staticClass:"icon-and-text"},[t.loading?e("NcLoadingIcon",{staticClass:"icon",attrs:{size:20}}):e("AssistantIcon",{staticClass:"icon",attrs:{size:20}}),t._v(" "),e("strong",{staticClass:"app-name"},[t._v("\n\t\t\t\t"+t._s(t.t("assistant","Image generation")+":")+"\n\t\t\t")]),t._v("\n\t\t\t"+t._s(t.prompt)+"\n\t\t")],1),t._v(" "),t.isOwner?e("Cog",{staticClass:"edit-icon",class:{active:t.editModeEnabled},attrs:{size:30,title:t.t("assistant","Edit visible images")},on:{click:t.toggleEditMode}}):t._e()],1),t._v(" "),t.editModeEnabled&&t.isOwner?e("div",[t.imageUrls.length>0&&!t.failed?e("div",{staticClass:"image-list"},t._l(t.imageUrls,(function(i,n){return e("div",{key:n,staticClass:"image-container",on:{mouseover:function(e){t.hoveredIndex=n},mouseout:function(e){t.hoveredIndex=-1}}},[e("div",{staticClass:"checkbox-container",class:{hovering:t.hoveredIndex===n}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fileVisStatusArray[n].visible,expression:"fileVisStatusArray[index].visible"}],attrs:{"v-show":!t.imgLoadedList[n],type:"checkbox",title:t.t("assistant","Click to toggle generation visibility")},domProps:{checked:Array.isArray(t.fileVisStatusArray[n].visible)?t._i(t.fileVisStatusArray[n].visible,null)>-1:t.fileVisStatusArray[n].visible},on:{change:[function(e){var i=t.fileVisStatusArray[n].visible,s=e.target,a=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.fileVisStatusArray[n],"visible",i.concat([null])):o>-1&&t.$set(t.fileVisStatusArray[n],"visible",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.fileVisStatusArray[n],"visible",a)},function(e){return t.onCheckboxChange()}]}})]),t._v(" "),e("div",{staticClass:"image-wrapper",class:{deselected:!t.fileVisStatusArray[n].visible}},[e("img",{staticClass:"image-editable",attrs:{src:i,title:t.t("assistant","Click to toggle generation visibility")},on:{load:function(e){return t.onImageLoad(n)},click:function(e){return t.toggleCheckbox(n)},error:t.onError}})])])})),0):t._e()]):e("div",[t.imageUrls.length>0&&!t.failed?e("div",{staticClass:"image-list"},[t._l(t.imageUrls,(function(i,n){return e("div",{key:n,staticClass:"image-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isOwner||t.fileVisStatusArray[n].visible,expression:"!isOwner || fileVisStatusArray[index].visible"}],staticClass:"image-wrapper"},[e("img",{staticClass:"image-non-editable",attrs:{src:i,title:t.t("assistant","Generated image")},on:{load:function(e){return t.onImageLoad(n)},error:t.onError}})])])})),t._v(" "),t.hasVisibleImages?t._e():e("div",{staticClass:"error_msg"},[t._v("\n\t\t\t\t"+t._s(t.t("assistant","This generation has no visible images"))+"\n\t\t\t")])],2):t._e()]),t._v(" "),!t.failed&&t.waitingInBg?e("div",{staticClass:"processing-notification-container"},[null!==t.timeUntilCompletion?e("div",{staticClass:"processing-notification"},[e("InformationOutlineIcon",{staticClass:"icon",attrs:{size:20}}),t._v("\n\t\t\t"+t._s(t.t("assistant","Estimated generation time left: ")+t.timeUntilCompletion+". ")+"\n\t\t\t"+t._s(t.t("assistant","The image(s) will be displayed here once generated."))+"\n\t\t")],1):e("div",{staticClass:"processing-notification"},[e("InformationOutlineIcon",{staticClass:"icon",attrs:{size:20}}),t._v("\n\t\t\t"+t._s(t.t("assistant","This image generation was scheduled to run in the background."))+"\n\t\t\t"+t._s(t.t("assistant","The image(s) will be displayed here once generated."))+"\n\t\t")],1)]):t._e(),t._v(" "),t.failed?e("span",{staticClass:"error_msg"},[t._v("\n\t\t"+t._s(t.errorMsg)+"\n\t")]):t._e()])},s="textGenerationReference"!=i.j?[]:null},2382:(t,e,i)=>{i.d(e,{X:()=>n,Y:()=>s});var n=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon assistant-icon",attrs:{"aria-hidden":!t.title,"aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{attrs:{fill:t.fillColor,width:t.size,height:t.size,"enable-background":"new 0 0 24 24",version:"1.1",viewBox:"0 0 24 24","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18,4C16.29,4 15.25,4.33 14.65,4.61C13.88,4.23 13,4 12,4C11,4 10.12,4.23 9.35,4.61C8.75,4.33 7.71,4 6,4C3,4 1,12 1,14C1,14.83 2.32,15.59 4.14,15.9C4.78,18.14 7.8,19.85 11.5,20V15.72C10.91,15.35 10,14.68 10,14C10,13 12,13 12,13C12,13 14,13 14,14C14,14.68 13.09,15.35 12.5,15.72V20C16.2,19.85 19.22,18.14 19.86,15.9C21.68,15.59 23,14.83 23,14C23,12 21,4 18,4M4.15,13.87C3.65,13.75 3.26,13.61 3,13.5C3.25,10.73 5.2,6.4 6.05,6C6.59,6 7,6.06 7.37,6.11C5.27,8.42 4.44,12.04 4.15,13.87M9,12A1,1 0 0,1 8,11C8,10.46 8.45,10 9,10A1,1 0 0,1 10,11C10,11.56 9.55,12 9,12M15,12A1,1 0 0,1 14,11C14,10.46 14.45,10 15,10A1,1 0 0,1 16,11C16,11.56 15.55,12 15,12M19.85,13.87C19.56,12.04 18.73,8.42 16.63,6.11C17,6.06 17.41,6 17.95,6C18.8,6.4 20.75,10.73 21,13.5C20.75,13.61 20.36,13.75 19.85,13.87Z"}})])])},s="textGenerationReference"!=i.j?[]:null},7457:(t,e,i)=>{i.d(e,{A:()=>r});var n=i(1354),s=i.n(n),a=i(6314),o=i.n(a)()(s());o.push([t.id,".display-container[data-v-7b742f64]{display:flex;flex-direction:column;align-items:center;justify-content:center}.display-container .edit-icon[data-v-7b742f64]{position:static;opacity:.2;transition:opacity .2s ease-in-out;cursor:pointer}.display-container .edit-icon.active[data-v-7b742f64]{opacity:1;cursor:pointer}.display-container .image-list[data-v-7b742f64]{display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center}.display-container .image-container[data-v-7b742f64]{display:flex;flex-direction:column;position:relative;justify-content:center}.display-container .checkbox-container[data-v-7b742f64]{position:absolute;top:4%;right:4%;z-index:1;opacity:.2;transition:opacity .2s ease-in-out}.display-container .checkbox-container>input[data-v-7b742f64]{cursor:pointer}.display-container .checkbox-container.hovering[data-v-7b742f64]{opacity:1}.display-container .image-wrapper[data-v-7b742f64]{display:flex;flex-direction:column;position:relative;max-width:100%;height:100%;margin-top:12px;filter:none;transition:filter .2s ease-in-out}.display-container .image-wrapper.deselected[data-v-7b742f64]{filter:grayscale(100%) brightness(50%)}.display-container .image-editable[data-v-7b742f64]{display:flex;width:100%;height:100%;min-width:400px;object-fit:contain;cursor:pointer;border-radius:var(--border-radius)}.display-container .image-non-editable[data-v-7b742f64]{display:flex;width:100%;height:100%;min-width:400px;object-fit:contain}.display-container .title[data-v-7b742f64]{width:100%;display:flex;flex-direction:row;margin-top:0}.display-container .title .icon-and-text[data-v-7b742f64]{width:100%;display:flex;flex-direction:row;align-items:center;justify-content:start;margin-right:8px}.display-container .title .icon-and-text .app-name[data-v-7b742f64]{margin-right:8px;white-space:nowrap}.display-container .title .icon[data-v-7b742f64]{margin-right:8px}.display-container .processing-notification-container[data-v-7b742f64]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:16px}.display-container .processing-notification-container .processing-notification[data-v-7b742f64]{display:flex;flex-direction:row;width:90%;align-items:center;justify-content:center;border:3px solid var(--color-border);border-radius:var(--border-radius-large);padding:12px;font-size:.8rem;column-gap:24px}.display-container .error_msg[data-v-7b742f64]{color:var(--color-error);font-weight:bold;margin-bottom:24px;align-self:center}","",{version:3,sources:["webpack://./src/components/Text2Image/Text2ImageDisplay.vue"],names:[],mappings:"AACA,oCACC,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,+CACC,eAAA,CACA,UAAA,CACA,kCAAA,CACA,cAAA,CAGD,sDACC,SAAA,CACA,cAAA,CAGD,gDACC,YAAA,CACA,qBAAA,CACA,cAAA,CACA,sBAAA,CAGD,qDACC,YAAA,CACA,qBAAA,CACA,iBAAA,CACA,sBAAA,CAGD,wDACC,iBAAA,CACA,MAAA,CACA,QAAA,CACA,SAAA,CACA,UAAA,CACA,kCAAA,CACA,8DACC,cAAA,CAGF,iEACC,SAAA,CAOD,mDACC,YAAA,CACA,qBAAA,CACA,iBAAA,CACA,cAAA,CACA,WAAA,CACA,eAAA,CACA,WAAA,CACA,iCAAA,CAGD,8DACC,sCAAA,CAGD,oDACC,YAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,kBAAA,CACA,cAAA,CACA,kCAAA,CAGD,wDACC,YAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,kBAAA,CAGD,2CACC,UAAA,CACA,YAAA,CACA,kBAAA,CACA,YAAA,CAEA,0DACC,UAAA,CACA,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,qBAAA,CACA,gBAAA,CAEA,oEACC,gBAAA,CACA,kBAAA,CAIF,iDACC,gBAAA,CAIF,uEACC,UAAA,CACA,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,eAAA,CAEA,gGACC,YAAA,CACA,kBAAA,CACA,SAAA,CACA,kBAAA,CACA,sBAAA,CAEA,oCAAA,CACA,wCAAA,CACA,YAAA,CAEA,eAAA,CAEA,eAAA,CAIF,+CACC,wBAAA,CACA,gBAAA,CACA,kBAAA,CACA,iBAAA",sourcesContent:["\n.display-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\t.edit-icon {\n\t\tposition: static;\n\t\topacity: 0.2;\n\t\ttransition: opacity 0.2s ease-in-out;\n\t\tcursor: pointer;\n\t}\n\n\t.edit-icon.active {\n\t\topacity: 1;\n\t\tcursor: pointer;\n\t}\n\n\t.image-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: center;\n\t}\n\n\t.image-container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tposition: relative;\n\t\tjustify-content: center;\n\t}\n\n\t.checkbox-container {\n\t\tposition: absolute;\n\t\ttop: 4%;\n\t\tright: 4%;\n\t\tz-index: 1;\n\t\topacity: 0.2;\n\t\ttransition: opacity 0.2s ease-in-out;\n\t\t> input {\n\t\t\tcursor: pointer;\n\t\t}\n\t}\n\t.checkbox-container.hovering {\n\t\topacity: 1;\n\t}\n\n\t/*.checkbox {\n\t\tcursor: pointer;\n\t}*/\n\n\t.image-wrapper {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tposition: relative;\n\t\tmax-width: 100%;\n\t\theight: 100%;\n\t\tmargin-top: 12px;\n\t\tfilter: none;\n\t\ttransition: filter 0.2s ease-in-out;\n\t}\n\n\t.image-wrapper.deselected {\n\t\tfilter: grayscale(100%) brightness(50%);\n\t}\n\n\t.image-editable {\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tmin-width: 400px;\n\t\tobject-fit:contain;\n\t\tcursor: pointer;\n\t\tborder-radius: var(--border-radius);\n\t}\n\n\t.image-non-editable {\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tmin-width: 400px;\n\t\tobject-fit:contain;\n\t}\n\n\t.title {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin-top: 0;\n\n\t\t.icon-and-text {\n\t\t\twidth: 100%;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t\tjustify-content: start;\n\t\t\tmargin-right: 8px;\n\n\t\t\t.app-name {\n\t\t\t\tmargin-right: 8px;\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\t\t}\n\n\t\t.icon {\n\t\t\tmargin-right: 8px;\n\t\t}\n\t}\n\n\t.processing-notification-container {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin-top: 16px;\n\n\t\t.processing-notification {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\twidth: 90%;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\t// Add a border\n\t\t\tborder: 3px solid var(--color-border);\n\t\t\tborder-radius: var(--border-radius-large);\n\t\t\tpadding: 12px;\n\t\t\t// Reduce the font size\n\t\t\tfont-size: 0.8rem;\n\t\t\t// Add some space between the icon and the text on the same line\n\t\t\tcolumn-gap: 24px;\n\t\t}\n\t}\n\n\t.error_msg {\n\t\tcolor: var(--color-error);\n\t\tfont-weight: bold;\n\t\tmargin-bottom: 24px;\n\t\talign-self: center;\n\n\t}\n}\n"],sourceRoot:""}]);const r="textGenerationReference"!=i.j?o:null},4284:(t,e,i)=>{var n=i(5072),s=i.n(n),a=i(7825),o=i.n(a),r=i(7659),A=i.n(r),l=i(5056),d=i.n(l),c=i(540),C=i.n(c),g=i(1113),p=i.n(g),m=i(7457),h={};h.styleTagTransform=p(),h.setAttributes=d(),h.insert=A().bind(null,"head"),h.domAPI=o(),h.insertStyleElement=C();s()(m.A,h),m.A&&m.A.locals&&m.A.locals},3947:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(4481),s=i(2128);i(3227);const a=(0,i(4486).A)(s.A,n.X,n.Y,!1,null,"7b742f64",null).exports},127:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(2382),s=i(5707);const a=(0,i(4486).A)(s.A,n.X,n.Y,!1,null,null,null).exports},2128:(t,e,i)=>{i.d(e,{A:()=>s});var n=i(2995);const s="textGenerationReference"!=i.j?n.A:null},5707:(t,e,i)=>{i.d(e,{A:()=>s});var n=i(6062);const s="textGenerationReference"!=i.j?n.A:null},3227:(t,e,i)=>{i(4284)}}]);
//# sourceMappingURL=assistant-src_components_Text2Image_Text2ImageDisplay_vue.js.map?v=cc32b297decc64917030